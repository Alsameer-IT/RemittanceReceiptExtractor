<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Remittance Receipt Extractor</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        .country-section {
            flex: 1;
            min-width: 360px;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 5px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #333;
            font-size: 24px;
        }
        .upload-section {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            border: 2px dashed #ccc;
            border-radius: 5px;
        }
        .upload-section p {
            margin: 10px 0 0 0;
            color: #555;
            font-size: 14px;
        }
        .receipt-container {
            display: none;
            margin-top: 30px;
            border: 1px solid #ddd;
            padding: 20px;
            border-radius: 5px;
            background-color: white;
        }
        .section {
            margin-bottom: 20px;
        }
        .section-title {
            background-color: #f8f9fa;
            padding: 8px 15px;
            font-weight: bold;
            border-left: 4px solid #3498db;
            margin-bottom: 10px;
        }
        .detail-row {
            display: flex;
            margin-bottom: 8px;
            flex-wrap: wrap;
        }
        .detail-key {
            font-weight: bold;
            width: 200px;
            color: #555;
        }
        .detail-value {
            flex: 1;
            white-space: pre-wrap;
        }
        .total-amount {
            font-weight: bold;
            font-size: 18px;
            text-align: right;
            margin-top: 20px;
            padding-top: 10px;
            border-top: 1px solid #eee;
        }
        .button-container {
            text-align: center;
            margin-top: 20px;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #2980b9;
        }
        .file-input {
            display: none;
        }
        .upload-label {
            display: inline-block;
            padding: 10px 20px;
            background-color: #3498db;
            color: white;
            border-radius: 4px;
            cursor: pointer;
        }
        .upload-label:hover {
            background-color: #2980b9;
        }
        .loading {
            display: none;
            text-align: center;
            margin: 10px 0;
            color: #555;
        }
        .error-message {
            color: #e74c3c;
            text-align: center;
            margin-top: 10px;
            display: none;
        }
        @media (max-width: 768px) {
            .country-section {
                min-width: 100%;
            }
            .detail-key {
                width: 150px;
            }
            h1 {
                font-size: 20px;
            }
            button, .upload-label {
                font-size: 14px;
                padding: 8px 16px;
            }
        }
        header {
            background-color: #3498db;
            color: white;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .logout-btn {
            background-color: #e74c3c;
            padding: 8px 16px;
            margin-left: 10px;
        }
        .logout-btn:hover {
            background-color: #c0392b;
        }
    </style>
</head>
<body>
    <script>
        // Check authentication
        if (sessionStorage.getItem('authenticated') !== 'true') {
    window.location.href = 'login.html';
}

        // Update last active timestamp
        function updateLastActive() {
            const sessionId = sessionStorage.getItem('sessionId');
            if (!sessionId) return;

            const loginData = JSON.parse(localStorage.getItem('loginData')) || [];
            const userEntry = loginData.find(entry => entry.sessionId === sessionId);
            if (userEntry && userEntry.isActive) {
                userEntry.lastActive = new Date().toISOString();
                localStorage.setItem('loginData', JSON.stringify(loginData));
            }
        }

        // Heartbeat to update last active every 10 seconds
        updateLastActive();
        const heartbeatInterval = setInterval(updateLastActive, 10000);

        // Detect website exit (tab/window close)
        window.addEventListener('beforeunload', () => {
            const sessionId = sessionStorage.getItem('sessionId');
            if (sessionId) {
                const loginData = JSON.parse(localStorage.getItem('loginData')) || [];
                const userEntry = loginData.find(entry => entry.sessionId === sessionId);
                if (userEntry) {
                    userEntry.isActive = false;
                    userEntry.lastActive = new Date().toISOString();
                    localStorage.setItem('loginData', JSON.stringify(loginData));
                }
            }
            clearInterval(heartbeatInterval); // Stop heartbeat on exit
        });

        // Logout function
        function logout() {
            const sessionId = sessionStorage.getItem('sessionId');
            const loginData = JSON.parse(localStorage.getItem('loginData')) || [];
            const userEntry = loginData.find(entry => entry.sessionId === sessionId);
            if (userEntry) {
                userEntry.isActive = false;
                userEntry.lastActive = new Date().toISOString();
                localStorage.setItem('loginData', JSON.stringify(loginData));
            }
            clearInterval(heartbeatInterval); // Stop heartbeat on logout
            sessionStorage.clear();
            window.location.href = 'login.html';
        }

        // Update last active on user interactions (e.g., file upload, button clicks)
        document.addEventListener('click', updateLastActive);
        document.addEventListener('change', updateLastActive);

        // Global variable to store the latest payout country
        let latestPayoutCountry = '';

        // Country code mapping for flag display
        const countryCodeMap = {
            'indonesia': 'id',
            'bangladesh': 'bd',
            'india': 'in',
            'united states': 'us',
            'united kingdom': 'gb',
            'canada': 'ca',
            'australia': 'au',
            'japan': 'jp',
            'china': 'cn',
            'germany': 'de',
            'france': 'fr',
            'brazil': 'br',
            'south africa': 'za',
            'russia': 'ru',
            'mexico': 'mx',
            'south korea': 'kr',
            'italy': 'it',
            'spain': 'es',
            'netherlands': 'nl',
            'sweden': 'se'
            // Add more mappings as needed
        };

        // Function to normalize country names for matching
        function normalizeCountryName(country) {
            if (!country || country.toLowerCase() === 'n/a') return '';
            const normalized = country.toLowerCase().trim();
            // Handle variations
            if (normalized.includes('indo')) return 'indonesia';
            if (normalized.includes('bd') || normalized.includes('bdesh')) return 'bangladesh';
            if (normalized.includes('usa') || normalized.includes('united states')) return 'united states';
            if (normalized.includes('uk') || normalized.includes('united kingdom')) return 'united kingdom';
            return normalized;
        }

        // Function to get country code
        function getCountryCode(country) {
            const normalized = normalizeCountryName(country);
            return countryCodeMap[normalized] || '';
        }

        // Function to update header flag based on payout country
        function updateHeaderFlag(payoutCountry) {
            latestPayoutCountry = normalizeCountryName(payoutCountry);
            const flagImg = document.getElementById('headerFlag');
            const countryCode = getCountryCode(latestPayoutCountry);
            if (countryCode) {
                flagImg.src = `https://flagcdn.com/w40/${countryCode}.png`;
                flagImg.alt = `${latestPayoutCountry} Flag`;
                flagImg.style.display = 'inline-block';
            } else {
                flagImg.style.display = 'none';
            }
        }

        // Function to update Global Remittance section flag and title
        function updateGlobalSectionFlag(payoutCountry) {
            const flagImg = document.getElementById('globalCountryFlag');
            const countryNameSpan = document.getElementById('globalCountryName');
            const normalizedCountry = normalizeCountryName(payoutCountry);
            const countryCode = getCountryCode(normalizedCountry);

            if (countryCode && normalizedCountry) {
                flagImg.src = `https://flagcdn.com/w40/${countryCode}.png`;
                flagImg.alt = `${normalizedCountry} Flag`;
                flagImg.style.display = 'inline-block';
                countryNameSpan.textContent = normalizedCountry.charAt(0).toUpperCase() + normalizedCountry.slice(1);
            } else {
                flagImg.src = '';
                flagImg.alt = 'Country Flag';
                flagImg.style.display = 'none';
                countryNameSpan.textContent = 'Global Remittance';
            }
        }
    </script>

    <header>
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h1 style="margin: 0; font-size: 24px;">
                <img id="headerFlag" src="" alt="Country Flag" style="width: 40px; height: 40px; vertical-align: middle; margin-left: 8px; border: 2px solid #000; border-radius: 4px; display: none;">
            </h1>
            <button class="logout-btn" onclick="logout()">Logout</button>
        </div>
    </header>

    <div class="container">
        <!-- Global Section -->
        <div class="country-section">
            <div style="text-align: center;">
                <h1 style="display: inline-block; font-family: Arial, Helvetica, sans-serif;">
                    <img id="globalCountryFlag" src="" alt="Country Flag" style="width: 40px; height: 40px; vertical-align: middle; margin-right: 8px; border: 2px solid #000; border-radius: 4px; display: none;">
                    <span id="globalCountryName">Global Remittance</span>
                </h1>
            </div>
            <div class="upload-section">
                <input type="file" id="globalFileInput" class="file-input" accept=".pdf">
                <label for="globalFileInput" class="upload-label">Choose PDF File</label>
                <p id="globalFileName">No file selected</p>
                <div id="globalLoading" class="loading">Processing...</div>
                <div id="globalCountryError" class="error-message">Receipt can only be downloaded for a valid payout country.</div>
            </div>
            <div class="receipt-container" id="globalReceiptContainer">
                <div class="section">
                    <div class="section-title">Receipt Metadata</div>
                    <div class="detail-row">
                        <div class="detail-key">Transaction No:</div>
                        <div class="detail-value" id="globalTxnNo"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-key">Receipt No:</div>
                        <div class="detail-value" id="globalReceiptNo"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-key">Reference Number:</div>
                        <div class="detail-value" id="globalReferenceNumber"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-key">Date:</div>
                        <div class="detail-value" id="globalDate"></div>
                    </div>
                </div>
                <div class="section">
                    <div class="section-title">Transaction Details</div>
                    <div class="detail-row">
                        <div class="detail-key">Payment Channel:</div>
                        <div class="detail-value" id="globalPaymentChannel"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-key">Pin:</div>
                        <div class="detail-value" id="globalPin"></div>
                    </div>
                </div>
                <div class="section">
                    <div class="section-title">Sender Details</div>
                    <div class="detail-row">
                        <div class="detail-key">Customer Id:</div>
                        <div class="detail-value" id="globalCustomerId"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-key">Name:</div>
                        <div class="detail-value" id="globalSenderName"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-key">Address:</div>
                        <div class="detail-value" id="globalSenderAddress"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-key">Passport:</div>
                        <div class="detail-value" id="globalNationalId"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-key">Nationality:</div>
                        <div class="detail-value" id="globalNationality"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-key">Profession:</div>
                        <div class="detail-value" id="globalProfession"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-key">Mobile No:</div>
                        <div class="detail-value" id="globalSenderMobile"></div>
                    </div>
                </div>
                <div class="section">
                    <div class="section-title">Beneficiary Details</div>
                    <div class="detail-row">
                        <div class="detail-key">Name:</div>
                        <div class="detail-value" id="globalBeneficiaryName"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-key">Bank Name:</div>
                        <div class="detail-value" id="globalBankName"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-key">Account No:</div>
                        <div class="detail-value" id="globalAccountNo"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-key">IFSC/Bank Code:</div>
                        <div class="detail-value" id="globalIfscCode"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-key">Mobile No:</div>
                        <div class="detail-value" id="globalBeneficiaryMobile"></div>
                    </div>
                </div>
                <div class="section">
                    <div class="section-title">Payment Details</div>
                    <div class="detail-row">
                        <div class="detail-key">Payout Country:</div>
                        <div class="detail-value" id="globalPayoutCountry"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-key">Source:</div>
                        <div class="detail-value" id="globalSource"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-key">Purpose:</div>
                        <div class="detail-value" id="globalPurpose"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-key">Payout Amount:</div>
                        <div class="detail-value" id="globalPayoutAmount"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-key">Exchange Rate:</div>
                        <div class="detail-value" id="globalExchangeRate"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-key">Pay in Amount:</div>
                        <div class="detail-value" id="globalPayInAmount"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-key">Service Charge:</div>
                        <div class="detail-value" id="globalServiceCharge"></div>
                    </div>
                    <div class="total-amount" id="globalTotalAmount"></div>
                </div>
                <div class="button-container">
                    <button id="globalDownloadBtn" disabled title="Upload a valid PDF to enable download">Get Receipt</button>
                    <button id="globalResetBtn" style="background-color: #e74c3c; margin-left: 10px;">Reset</button>
                </div>
            </div>
        </div>

        <!-- Indonesia Section -->
        <div class="country-section">
            <div style="text-align: center;">
                <h1 style="display: inline-block; font-family: Arial, Helvetica, sans-serif;">
                    <img src="https://flagcdn.com/w40/id.png" alt="Indonesia Flag" style="vertical-align: middle; margin-right: 8px; border: 2px solid #000; border-radius: 4px;">
                    Indonesia
                </h1>
            </div>
            <div class="upload-section">
                <input type="file" id="indonesiaFileInput" class="file-input" accept=".pdf">
                <label for="indonesiaFileInput" class="upload-label">Choose PDF File</label>
                <p id="indonesia">No file selected</p>
                <div id="indonesiaLoading" class="loading">Processing...</div>
                <div id="indonesiaCountryError" class="error-message">Receipt can only be downloaded for Indonesia payout country.</div>
            </div>
            <div class="receipt-container" id="indonesiaReceiptContainer">
                <div class="section">
                    <div class="section-title">Receipt Metadata</div>
                    <div class="detail-row">
                        <div class="detail-key">Receipt No:</div>
                        <div class="detail-value" id="indonesiaReceiptNo"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-key">Transaction No:</div>
                        <div class="detail-value" id="indonesiaTxnNo"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-key">Date:</div>
                        <div class="detail-value" id="indonesiaDate"></div>
                    </div>
                </div>
                <div class="section">
                    <div class="section-title">Sender Details</div>
                    <div class="detail-row">
                        <div class="detail-key">Customer Id:</div>
                        <div class="detail-value" id="indonesiaCustomerId"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-key">Name:</div>
                        <div class="detail-value" id="indonesiaSenderName"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-key">Address:</div>
                        <div class="detail-value" id="indonesiaSenderAddress"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-key">National ID:</div>
                        <div class="detail-value" id="indonesiaNationalId"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-key">Nationality:</div>
                        <div class="detail-value" id="indonesiaNationality"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-key">Profession:</div>
                        <div class="detail-value" id="indonesiaProfession"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-key">Mobile No:</div>
                        <div class="detail-value" id="indonesiaSenderMobile"></div>
                    </div>
                </div>
                <div class="section">
                    <div class="section-title">Beneficiary Details</div>
                    <div class="detail-row">
                        <div class="detail-key">Name:</div>
                        <div class="detail-value" id="indonesiaBeneficiaryName"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-key">Bank Name:</div>
                        <div class="detail-value" id="indonesiaBankName"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-key">Account No:</div>
                        <div class="detail-value" id="indonesiaAccountNo"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-key">IFSC/Bank Code:</div>
                        <div class="detail-value" id="indonesiaIfscCode"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-key">Mobile No:</div>
                        <div class="detail-value" id="indonesiaBeneficiaryMobile"></div>
                    </div>
                </div>
                <div class="section">
                    <div class="section-title">Payment Details</div>
                    <div class="detail-row">
                        <div class="detail-key">Payout Country:</div>
                        <div class="detail-value" id="indonesiaPayoutCountry"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-key">Source:</div>
                        <div class="detail-value" id="indonesiaSource"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-key">Purpose:</div>
                        <div class="detail-value" id="indonesiaPurpose"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-key">Payout Amount:</div>
                        <div class="detail-value" id="indonesiaPayoutAmount"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-key">Exchange Rate:</div>
                        <div class="detail-value" id="indonesiaExchangeRate"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-key">Pay in Amount:</div>
                        <div class="detail-value" id="indonesiaPayInAmount"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-key">Service Charge:</div>
                        <div class="detail-value" id="indonesiaServiceCharge"></div>
                    </div>
                    <div class="total-amount" id="indonesiaTotalAmount"></div>
                </div>
                <div class="button-container">
                    <button id="indonesiaDownloadBtn" disabled title="Upload a valid PDF to enable download">Get Receipt</button>
                    <button id="indonesiaResetBtn" style="background-color: #e74c3c; margin-left: 10px;">Reset</button>
                </div>
            </div>
        </div>
        <!-- Bangladesh Section -->
        <div class="country-section">
            <div style="text-align: center;">
                <h1 style="display: inline-block; font-family: Arial, Helvetica, sans-serif;">
                    <img src="https://flagcdn.com/w40/bd.png" alt="Bangladesh Flag" style="vertical-align: middle; margin-right: 8px; border: 2px solid #000; border-radius: 4px;">
                    Bangladesh
                </h1>
            </div>
            <div class="upload-section">
                <input type="file" id="bangladeshFileInput" class="file-input" accept=".pdf">
                <label for="bangladeshFileInput" class="upload-label">Choose PDF File</label>
                <p id="bangladeshFileName">No file selected</p>
                <div id="bangladeshLoading" class="loading">Processing...</div>
                <div id="bangladeshCountryError" class="error-message">Receipt can only be downloaded for Bangladesh payout country.</div>
            </div>
            <div class="receipt-container" id="bangladeshReceiptContainer">
                <div class="section">
                    <div class="section-title">Transaction Details</div>
                    <div class="detail-row"><div class="detail-key">Ref No:</div><div class="detail-value" id="bangladeshRefNo"></div></div>
                    <div class="detail-row"><div class="detail-key">Transaction No:</div><div class="detail-value" id="bangladeshTxnNo"></div></div>
                    <div class="detail-row"><div class="detail-key">Date:</div><div class="detail-value" id="bangladeshDate"></div></div>
                </div>
                <div class="section">
                    <div class="section-title">Sender Details</div>
                    <div class="detail-row"><div class="detail-key">Name:</div><div class="detail-value" id="bangladeshSenderName"></div></div>
                    <div class="detail-row"><div class="detail-key">Passport No:</div><div class="detail-value" id="bangladeshPassportNo"></div></div>
                    <div class="detail-row"><div class="detail-key">IC No:</div><div class="detail-value" id="bangladeshIcNo"></div></div>
                    <div class="detail-row"><div class="detail-key">Address:</div><div class="detail-value" id="bangladeshSenderAddress"></div></div>
                    <div class="detail-row"><div class="detail-key">Citizenship:</div><div class="detail-value" id="bangladeshCitizenship"></div></div>
                    <div class="detail-row"><div class="detail-key">Mobile No:</div><div class="detail-value" id="bangladeshSenderMobile"></div></div>
                </div>
                <div class="section">
                    <div class="section-title">Beneficiary Details</div>
                    <div class="detail-row"><div class="detail-key">Name:</div><div class="detail-value" id="bangladeshBeneficiaryName"></div></div>
                    <div class="detail-row"><div class="detail-key">Mobile No:</div><div class="detail-value" id="bangladeshBeneficiaryMobile"></div></div>
                    <div class="detail-row"><div class="detail-key">Bank Name:</div><div class="detail-value" id="bangladeshBankName"></div></div>
                    <div class="detail-row"><div class="detail-key">Account No:</div><div class="detail-value" id="bangladeshAccountNo"></div></div>
                    <div class="detail-row"><div class="detail-key">Bank Branch:</div><div class="detail-value" id="bangladeshBankBranch"></div></div>
                    <div class="detail-row"><div class="detail-key">IFSC/Routing No:</div><div class="detail-value" id="bangladeshIfscRoutingNo"></div></div>
                </div>
                <div class="section">
                    <div class="section-title">Payment Details</div>
                    <div class="detail-row"><div class="detail-key">Payment Channel:</div><div class="detail-value" id="bangladeshPaymentChannel"></div></div>
                    <div class="detail-row"><div class="detail-key">Cash Pick-up at:</div><div class="detail-value" id="bangladeshCashPickupAt"></div></div>
                    <div class="detail-row"><div class="detail-key">Payout Code:</div><div class="detail-value" id="bangladeshPayoutCode"></div></div>
                    <div class="detail-row"><div class="detail-key">Source:</div><div class="detail-value" id="bangladeshSource"></div></div>
                    <div class="detail-row"><div class="detail-key">Purpose:</div><div class="detail-value" id="bangladeshPurpose"></div></div>
                    <div class="detail-row"><div class="detail-key">Destination Country:</div><div class="detail-value" id="bangladeshDestinationCountry"></div></div>
                    <div class="detail-row"><div class="detail-key">Payout Amount:</div><div class="detail-value" id="bangladeshPayoutAmount"></div></div>
                    <div class="detail-row"><div class="detail-key">Exchange Rate:</div><div class="detail-value" id="bangladeshExchangeRate"></div></div>
                    <div class="detail-row"><div class="detail-key">Send Amount in BND:</div><div class="detail-value" id="bangladeshSendAmount"></div></div>
                    <div class="detail-row"><div class="detail-key">Service Fee:</div><div class="detail-value" id="bangladeshServiceFee"></div></div>
                    <div class="total-amount" id="bangladeshTotalPaid"></div>
                </div>
                <div class="button-container">
                    <button id="bangladeshDownloadBtn" disabled title="Upload a valid PDF to enable download">Get Receipt</button>
                    <button id="bangladeshResetBtn" style="background-color: #e74c3c; margin-left: 10px;">Reset</button>
                </div>
            </div>
        </div>

        <!-- Platinum Section (Updated to match website 2 design) -->
        <div class="country-section">
            <div style="text-align: center;">
                <h1 style="display: inline-block; font-family: Arial, Helvetica, sans-serif;">
                    <img src="https://cdn-icons-png.flaticon.com/512/1034/1034551.png" 
                         alt="Platinum" 
                         style="width: 40px; height: 40px; margin-right: 8px; border: 2px solid #000; border-radius: 4px;">
                    Platinum
                </h1>
            </div>
            <div class="upload-section">
                <input type="file" id="platinumFileInput" class="file-input" accept=".pdf">
                <label for="platinumFileInput" class="upload-label">Choose PDF File</label>
                <p id="platinumFileName">No file selected</p>
                <div id="platinumLoading" class="loading">Processing...</div>
                <div id="platinumCountryError" class="error-message">Receipt can only be downloaded for valid PDF files.</div>
            </div>
            <div class="receipt-container" id="platinumReceiptContainer">
                <!-- Section for Receipt Metadata -->
                <div class="section">
                    <div class="section-title">Receipt Metadata</div>
                    <div class="detail-row">
                        <div class="detail-key">Transaction No:</div>
                        <div class="detail-value" id="platinumTxnNo"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-key">Date:</div>
                        <div class="detail-value" id="platinumDate"></div>
                    </div>
                </div>

                <!-- Section for Transaction Details -->
                <div class="section">
                    <div class="section-title">Transaction Details</div>
                    <div class="detail-row">
                        <div class="detail-key">Payment Channel:</div>
                        <div class="detail-value" id="platinumPaymentChannel"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-key">Pin:</div>
                        <div class="detail-value" id="platinumPin"></div>
                    </div>
                </div>

                <div class="section">
                    <div class="section-title">Sender Details</div>
                    <div class="detail-row">
                        <div class="detail-key">Customer Id:</div>
                        <div class="detail-value" id="platinumCustomerId"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-key">Name:</div>
                        <div class="detail-value" id="platinumSenderName"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-key">Address:</div>
                        <div class="detail-value" id="platinumSenderAddress"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-key">Passport:</div>
                        <div class="detail-value" id="platinumNationalId"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-key">Nationality:</div>
                        <div class="detail-value" id="platinumNationality"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-key">Profession:</div>
                        <div class="detail-value" id="platinumProfession"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-key">Mobile No:</div>
                        <div class="detail-value" id="platinumSenderMobile"></div>
                    </div>
                </div>
                
                <div class="section">
                    <div class="section-title">Beneficiary Details</div>
                    <div class="detail-row">
                        <div class="detail-key">Name:</div>
                        <div class="detail-value" id="platinumBeneficiaryName"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-key">Bank Name:</div>
                        <div class="detail-value" id="platinumBankName"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-key">Account No:</div>
                        <div class="detail-value" id="platinumAccountNo"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-key">IFSC/Bank Code:</div>
                        <div class="detail-value" id="platinumIfscCode"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-key">Mobile No:</div>
                        <div class="detail-value" id="platinumBeneficiaryMobile"></div>
                    </div>
                </div>
                
                <div class="section">
                    <div class="section-title">Payment Details</div>
                    <div class="detail-row">
                        <div class="detail-key">Payout Country:</div>
                        <div class="detail-value" id="platinumPayoutCountry"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-key">Source:</div>
                        <div class="detail-value" id="platinumSource"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-key">Purpose:</div>
                        <div class="detail-value" id="platinumPurpose"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-key">Payout Amount:</div>
                        <div class="detail-value" id="platinumPayoutAmount"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-key">Exchange Rate:</div>
                        <div class="detail-value" id="platinumExchangeRate"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-key">Pay in Amount:</div>
                        <div class="detail-value" id="platinumPayInAmount"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-key">Service Charge:</div>
                        <div class="detail-value" id="platinumServiceCharge"></div>
                    </div>
                    <div class="total-amount" id="platinumTotalAmount"></div>
                </div>
                
                <div class="button-container">
                    <button id="platinumDownloadBtn" disabled title="Upload a valid PDF to enable download">Get Receipt</button>
                    <button id="platinumResetBtn" style="background-color: #e74c3c; margin-left: 10px;">Reset</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize PDF.js worker
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.worker.min.js';

        // Global Section
        const globalFileInput = document.getElementById('globalFileInput');
        const globalFileNameDisplay = document.getElementById('globalFileName');
        const globalReceiptContainer = document.getElementById('globalReceiptContainer');
        const globalLoadingIndicator = document.getElementById('globalLoading');
        const globalDownloadBtn = document.getElementById('globalDownloadBtn');
        const globalResetBtn = document.getElementById('globalResetBtn');
        const globalCountryError = document.getElementById('globalCountryError');

        globalFileInput.addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;

            globalFileNameDisplay.textContent = `Selected file: ${file.name}`;
            globalLoadingIndicator.style.display = 'block';
            globalCountryError.style.display = 'none';

            try {
                const extractedData = await extractDataFromPDFGlobal(file);
                populateReceiptGlobal(extractedData);
                globalReceiptContainer.style.display = 'block';

                const payoutCountry = extractedData.payoutCountry ? extractedData.payoutCountry.trim().toLowerCase() : '';
                updateHeaderFlag(payoutCountry);

                if (payoutCountry && payoutCountry !== 'n/a') {
                    globalDownloadBtn.disabled = false;
                    globalDownloadBtn.title = 'Download Receipt';
                    globalDownloadBtn.style.backgroundColor = '#3498db';
                } else {
                    globalDownloadBtn.disabled = true;
                    globalDownloadBtn.title = 'Receipt can only be downloaded for a valid payout country';
                    globalDownloadBtn.style.backgroundColor = '#95a5a6';
                    globalCountryError.style.display = 'block';
                    globalCountryError.textContent = 'Receipt can only be downloaded for a valid payout country';
                }
            } catch (error) {
                console.error('Error processing Global PDF:', error);
                let message = 'Error processing PDF. Please ensure it is a valid PDF and has the correct format.';
                if (error.message.includes('Invalid PDF')) {
                    message = 'The uploaded file is not a valid PDF.';
                } else if (error.message.includes('No text')) {
                    message = 'The PDF contains no extractable text.';
                }
                alert(message);
                globalDownloadBtn.disabled = true;
                globalDownloadBtn.title = 'Upload a valid PDF to enable download';
                globalDownloadBtn.style.backgroundColor = '#95a5a6';
                globalCountryError.style.display = 'block';
                globalCountryError.textContent = message;
            } finally {
                globalLoadingIndicator.style.display = 'none';
            }
        });

        globalResetBtn.addEventListener('click', () => {
            globalFileInput.value = '';
            globalFileNameDisplay.textContent = 'No file selected';
            globalReceiptContainer.style.display = 'none';
            globalDownloadBtn.disabled = true;
            globalDownloadBtn.style.backgroundColor = '#3498db';
            globalDownloadBtn.title = 'Upload a valid PDF to enable download';
            document.querySelectorAll('#globalReceiptContainer .detail-value').forEach(el => el.textContent = '');
            document.getElementById('globalTotalAmount').textContent = '';
            globalCountryError.style.display = 'none';
            updateHeaderFlag('');
            updateGlobalSectionFlag('');
        });

        async function extractDataFromPDFGlobal(file) {
            const arrayBuffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
            const page = await pdf.getPage(1);
            const textContent = await page.getTextContent();
            const textItems = textContent.items.map(item => item.str);

            let text = textItems.join('\n');
            text = text.replace(/\s*:\s*/g, ': ').replace(/\n\s+/g, '\n');

            console.log('Full extracted text (Global):', text);

            const topLeftDateMatch = text.match(/^\d{1,2}\/\d{1,2}\/\d{2},\s*\d{1,2}:\d{2}\s*(?:AM|PM)/im);
            const txnNoMatch = text.match(/(?:Transaction No|Txn\s*No|Reference Number):?\s*([A-Za-z0-9]+)/i);
            const receiptNoMatch = text.match(/Receipt\s*No:?\s*([A-Za-z0-9]+)/i);
            const paymentChannelMatch = text.match(/Payment Channel: ([^\n]+)/i);
            const pinMatch = text.match(/(?:^|\n)\s*Pin\s*:+\s*([A-Za-z0-9]+)/i);
            const dateMatch = text.match(/Date: (\d{2}-\d{2}-\d{4})/i);

            console.log('Pin Match (Global):', pinMatch);

            const senderSectionMatch = text.match(/Sender Details([\s\S]*?)Beneficary Details/i);
            let senderSection = senderSectionMatch ? senderSectionMatch[1] : '';
            console.log('Sender Section (Global):', senderSection);

            const customerIdMatch = senderSection.match(/Customer Id: ([^\n]+)/i);
            const senderNameMatch = senderSection.match(/Name: ([^\n]+)/i);
            const senderAddressMatch = senderSection.match(/Address: ([\s\S]*?)(?=(?:National ID|Passport))/i);
            let senderAddress = 'N/A';
            let senderAddressRaw = 'N/A';
            if (senderAddressMatch) {
                senderAddressRaw = senderAddressMatch[1].trim();
                senderAddress = senderAddressRaw.replace(/\n/g, ', ').trim();
            }
            const nationalIdMatch = senderSection.match(/(?:National ID|Passport): ([^\n]+)/i);
            const nationalityMatch = senderSection.match(/Nationality: ([^\n]+)/i);
            const professionMatch = senderSection.match(/Profession: ([^\n]+)/i);
            const senderMobileMatch = senderSection.match(/Mobile No: (\d+)/i) || 
                            senderSection.match(/Mobile\s*No: (\d+)/i);

            const senderName = senderNameMatch ? senderNameMatch[1].trim() : '';

            const beneficiarySectionMatch = text.match(/Beneficary Details([\s\S]*?)(?=Payout\s*(?:Amount|Country)|$)/i);
            let beneficiarySection = beneficiarySectionMatch ? beneficiarySectionMatch[1] : '';
            console.log('Beneficiary Section (Global):', beneficiarySection);

            const lines = beneficiarySection.split('\n');
            let beneficiaryData = {
                name: '',
                bankName: '',
                accountNo: 'N/A',
                ifscCode: 'N/A',
                routingNumber: 'N/A',
                branchName: 'N/A',
                mobileNo: 'N/A'
            };

            let fieldIndex = 0;
            let lastAccountNo = '';
            let expectingValue = false;

            for (let i = 0; i < lines.length && fieldIndex < 5; i++) {
                let line = lines[i].trim();

                if (!line) continue;

                console.log(`Processing Beneficiary Line ${i} (fieldIndex=${fieldIndex}): ${line}`);

                if (expectingValue) {
                    if (fieldIndex === 0) {
                        const nameMatch = line.match(/^:?\s*([^\n]+)/);
                        if (nameMatch) {
                            beneficiaryData.name = nameMatch[1].trim();
                            fieldIndex++;
                            expectingValue = false;
                        }
                    }
                    continue;
                }

                if (fieldIndex === 0 && line.match(/Name/i) && !line.match(/:/)) {
                    expectingValue = true;
                } else if (fieldIndex === 0 && line.match(/Name:/i)) {
                    const nameMatch = line.match(/Name: ([^\n]+)/i);
                    if (nameMatch) {
                        beneficiaryData.name = nameMatch[1].trim();
                        fieldIndex++;
                    }
                } else if (fieldIndex === 1 && line.match(/(?:Bank|Bank Name):/i)) {
                    const bankMatch = line.match(/(?:Bank|Bank Name): ([^\n]+)/i);
                    if (bankMatch) {
                        beneficiaryData.bankName = bankMatch[1].trim();
                        fieldIndex++;
                    }
                } else if (fieldIndex === 1 && !line.match(/(?:Bank|Bank Name):/i) && line.match(/[A-Z\s]+/)) {
                    beneficiaryData.bankName = line.trim();
                    fieldIndex++;
                } else if (fieldIndex === 2 && line.match(/Account No:/i)) {
                    const accountMatch = line.match(/Account No: ([^\n]+)/i);
                    if (accountMatch) {
                        beneficiaryData.accountNo = accountMatch[1].trim();
                        lastAccountNo = beneficiaryData.accountNo;
                        fieldIndex++;
                    }
                } else if (fieldIndex === 2 && line.match(/Mobile No:/i)) {
                    continue;
                } else if (fieldIndex === 3 && line.match(/(?:IFSC(?:\/Bank)?\s*Code|Branch\s*Code|Bank\s*Code|IFSC):/i)) {
                    const ifscMatch = line.match(/(?:IFSC(?:\/Bank)?\s*Code|Branch\s*Code|Bank\s*Code|IFSC): ([^\n]+)/i);
                    if (ifscMatch) {
                        const potentialIfsc = ifscMatch[1].trim();
                        console.log(`Found potential IFSC code with label: ${potentialIfsc}`);
                        if (potentialIfsc !== lastAccountNo && potentialIfsc.length > 1 && !potentialIfsc.match(/mobile/i)) {
                            beneficiaryData.ifscCode = potentialIfsc;
                            const ifscParts = potentialIfsc.split(/\s+/);
                            if (ifscParts.length >= 2) {
                                beneficiaryData.routingNumber = ifscParts[ifscParts.length - 1];
                                beneficiaryData.branchName = ifscParts.slice(0, -1).join(' ');
                            }
                        } else {
                            console.log('IFSC code matches account number, is too short, or contains "mobile", keeping as N/A');
                        }
                        fieldIndex++;
                    }
                } else if (fieldIndex === 3 && !line.match(/(?:IFSC(?:\/Bank)?\s*Code|Branch\s*Code|Bank\s*Code|IFSC):/i)) {
                    const potentialIfsc = line.trim();
                    console.log(`Found potential IFSC code without label: ${potentialIfsc}`);
                    if (potentialIfsc !== lastAccountNo && potentialIfsc.length > 1 && !potentialIfsc.match(/mobile/i)) {
                        beneficiaryData.ifscCode = potentialIfsc;
                        const ifscParts = potentialIfsc.split(/\s+/);
                        if (ifscParts.length >= 2) {
                            beneficiaryData.routingNumber = ifscParts[ifscParts.length - 1];
                            beneficiaryData.branchName = ifscParts.slice(0, -1).join(' ');
                        }
                    } else {
                        console.log('Potential IFSC code matches account number, is too short, or contains "mobile", keeping as N/A');
                    }
                    fieldIndex++;
                } else if (fieldIndex === 4 && line.match(/Mobile No:/i)) {
                    const mobileMatch = line.match(/Mobile No: (\d+)/i);
                    if (mobileMatch) {
                        const potentialMobile = mobileMatch[1].trim();
                        console.log(`Found potential Mobile No with label: ${potentialMobile}`);
                        if (potentialMobile !== lastAccountNo && /^\d+$/.test(potentialMobile)) {
                            beneficiaryData.mobileNo = potentialMobile;
                        } else {
                            console.log('Mobile No matches account number or is not numeric, keeping as N/A');
                        }
                        fieldIndex++;
                    }
                } else if (fieldIndex === 4 && line.match(/\d+/)) {
                    const potentialMobile = line.trim();
                    console.log(`Found potential Mobile No without label: ${potentialMobile}`);
                    if (potentialMobile !== lastAccountNo && /^\d+$/.test(potentialMobile)) {
                        beneficiaryData.mobileNo = potentialMobile;
                    } else {
                        console.log('Potential Mobile No matches account number or is not numeric, keeping as N/A');
                    }
                    fieldIndex++;
                }
            }

            if (!beneficiaryData.name) {
                const nameMatch = text.match(/Beneficary Details[\s\S]*?Name[\s\S]*?: ([^\n]+)/i);
                if (nameMatch) {
                    beneficiaryData.name = nameMatch[1].trim();
                }
            }
            if (!beneficiaryData.bankName) {
                const bankMatch = text.match(/Beneficary Details[\s\S]*?(?:Bank|Bank Name): ([^\n]+)/i);
                beneficiaryData.bankName = bankMatch ? bankMatch[1].trim() : '';
            }
            if (beneficiaryData.accountNo === 'N/A') {
                const accountMatch = text.match(/Beneficary Details[\s\S]*?Account No: ([^\n]+)/i);
                beneficiaryData.accountNo = accountMatch ? accountMatch[1].trim() : 'N/A';
            }
            if (beneficiaryData.ifscCode === 'N/A') {
                const ifscMatch = text.match(/Beneficary Details[\s\S]*?(?:IFSC(?:\/Bank)?\s*Code|Branch\s*Code|Bank\s*Code|IFSC): ([^\n]+)/i);
                if (ifscMatch) {
                    const potentialIfsc = ifscMatch[1].trim();
                    console.log(`Fallback IFSC code found: ${potentialIfsc}`);
                    if (potentialIfsc !== beneficiaryData.accountNo && potentialIfsc.length > 1 && !potentialIfsc.match(/mobile/i)) {
                        beneficiaryData.ifscCode = potentialIfsc;
                        const ifscParts = potentialIfsc.split(/\s+/);
                        if (ifscParts.length >= 2) {
                            beneficiaryData.routingNumber = ifscParts[ifscParts.length - 1];
                            beneficiaryData.branchName = ifscParts.slice(0, -1).join(' ');
                        }
                    } else {
                        console.log('Fallback IFSC code matches account number, is too short, or contains "mobile", keeping as N/A');
                    }
                }
            }
            if (beneficiaryData.mobileNo === 'N/A') {
                const mobileMatch = text.match(/Beneficary Details[\s\S]*?Mobile No: (\d+)/i);
                if (mobileMatch) {
                    const potentialMobile = mobileMatch[1].trim();
                    console.log(`Fallback Mobile No found: ${potentialMobile}`);
                    if (potentialMobile !== beneficiaryData.accountNo && /^\d+$/.test(potentialMobile)) {
                        beneficiaryData.mobileNo = potentialMobile;
                    }
                }
            }

            console.log('Extracted Beneficiary Data (Global):', beneficiaryData);

            const paymentSectionMatch = text.match(/(?:Payout\s*(?:Amount|Country)|PayoutCountry)([\s\S]*)$/i);
            let paymentSection = paymentSectionMatch ? paymentSectionMatch[1] : text;
            console.log('Payment Section (Global):', paymentSection);

            let payoutCountryMatch = paymentSection.match(/Payout Country: ([^\n]+)/i);
            if (!payoutCountryMatch) {
                payoutCountryMatch = paymentSection.match(/PayoutCountry: ([^\n]+)/i);
            }
            if (!payoutCountryMatch) {
                payoutCountryMatch = text.match(/Payout\s*Country: ([^\n]+)/i) || text.match(/PayoutCountry: ([^\n]+)/i);
            }

            const sourceMatch = paymentSection.match(/Source: ([^\n]+)/i);
            const purposeMatch = paymentSection.match(/Purpose: ([^\n]+)/i);
            const payoutAmountMatch = paymentSection.match(/([\d,]+\.\d{2})\s*([A-Z]{3})/i);
            const exchangeRateMatch = paymentSection.match(/Exchange Rate: ([\d.]+)\s*([A-Z]{3})/i);
            const payInAmountMatch = paymentSection.match(/Pay In Amount: ([\d,]+\.\d{2})\s*([A-Z]{3})/i);
            const serviceChargeMatch = paymentSection.match(/Service Charge: ([\d,]+\.\d{2})\s*([A-Z]{3})/i);
            const totalAmountMatch = paymentSection.match(/Total Amount: ([\d,]+\.\d{2})\s*([A-Z]{3})/i);

            const finalIfscCode = beneficiaryData.ifscCode && beneficiaryData.ifscCode.length > 1 && !beneficiaryData.ifscCode.match(/mobile/i) ? beneficiaryData.ifscCode : 'N/A';
            const finalMobileNo = beneficiaryData.mobileNo && /^\d+$/.test(beneficiaryData.mobileNo) ? beneficiaryData.mobileNo : 'N/A';

            let referenceNumber = txnNoMatch ? txnNoMatch[1].trim() : (receiptNoMatch ? receiptNoMatch[1].trim() : 'N/A');
            const randomDigits = () => Math.floor(Math.random() * 100).toString().padStart(2, '0');
            if (referenceNumber !== 'N/A') {
                const prefix = randomDigits();
                const suffix = randomDigits();
                referenceNumber = `${prefix}${referenceNumber}${suffix}`;
            }

            const extractedData = {
                txnNo: txnNoMatch ? txnNoMatch[1].trim() : 'N/A',
                receiptNo: receiptNoMatch ? receiptNoMatch[1].trim() : 'N/A',
                referenceNumber: referenceNumber,
                topLeftDate: topLeftDateMatch ? topLeftDateMatch[0].trim() : 'N/A',
                paymentChannel: paymentChannelMatch ? paymentChannelMatch[1].trim() : 'N/A',
                pin: pinMatch ? pinMatch[1].trim() : 'N/A',
                date: dateMatch ? dateMatch[1].trim() : 'N/A',
                customerId: customerIdMatch ? customerIdMatch[1].trim() : 'N/A',
                senderName: senderNameMatch ? senderNameMatch[1].trim() : 'N/A',
                senderAddress: senderAddress,
                senderAddressRaw: senderAddressRaw,
                nationalId: nationalIdMatch ? nationalIdMatch[1].trim() : 'N/A',
                nationality: nationalityMatch ? nationalityMatch[1].trim() : 'N/A',
                profession: professionMatch ? professionMatch[1].trim() : 'N/A',
                senderMobile: senderMobileMatch ? senderMobileMatch[1].trim() : 'N/A',
                beneficiaryName: beneficiaryData.name || 'N/A',
                bankName: beneficiaryData.bankName || 'N/A',
                accountNo: beneficiaryData.accountNo,
                ifscCode: finalIfscCode,
                routingNumber: beneficiaryData.routingNumber || 'N/A',
                branchName: beneficiaryData.branchName || 'N/A',
                beneficiaryMobile: finalMobileNo,
                payoutCountry: payoutCountryMatch ? payoutCountryMatch[1].trim() : 'N/A',
                source: sourceMatch ? sourceMatch[1].trim() : 'N/A',
                purpose: purposeMatch ? purposeMatch[1].trim() : 'N/A',
                payoutAmount: payoutAmountMatch ? `${payoutAmountMatch[1].trim()} ${payoutAmountMatch[2]}` : 'N/A',
                exchangeRate: exchangeRateMatch ? `${exchangeRateMatch[1].trim()} ${exchangeRateMatch[2]}` : 'N/A',
                payInAmount: payInAmountMatch ? `${payInAmountMatch[1].trim()} ${payInAmountMatch[2]}` : 'N/A',
                serviceCharge: serviceChargeMatch ? `${serviceChargeMatch[1].trim()} ${serviceChargeMatch[2]}` : 'N/A',
                totalAmount: totalAmountMatch ? `${totalAmountMatch[1].trim()} ${totalAmountMatch[2]}` : 'N/A'
            };

            console.log('Extracted Data (Global):', extractedData);
            return extractedData;
        }

        function populateReceiptGlobal(data) {
            console.log('Data passed to UI (Global):', data);

            updateGlobalSectionFlag(data.payoutCountry);

            document.getElementById('globalTxnNo').textContent = data.txnNo || 'N/A';
            document.getElementById('globalReceiptNo').textContent = data.receiptNo || 'N/A';
            document.getElementById('globalReferenceNumber').textContent = data.referenceNumber || 'N/A';
            document.getElementById('globalDate').textContent = data.date || 'N/A';
            document.getElementById('globalPaymentChannel').textContent = data.paymentChannel || 'N/A';
            document.getElementById('globalPin').textContent = data.pin || 'N/A';
            document.getElementById('globalCustomerId').textContent = data.customerId || 'N/A';
            document.getElementById('globalSenderName').textContent = data.senderName || 'N/A';
            document.getElementById('globalSenderAddress').innerHTML = (data.senderAddressRaw || 'N/A').replace(/\n/g, '<br>');
            document.getElementById('globalNationalId').textContent = data.nationalId || 'N/A';
            document.getElementById('globalNationality').textContent = data.nationality || 'N/A';
            document.getElementById('globalProfession').textContent = data.profession || 'N/A';
            document.getElementById('globalSenderMobile').textContent = data.senderMobile || 'N/A';
            document.getElementById('globalBeneficiaryName').textContent = data.beneficiaryName || 'N/A';
            document.getElementById('globalBankName').textContent = data.bankName || 'N/A';
            document.getElementById('globalAccountNo').textContent = data.accountNo || 'N/A';
            document.getElementById('globalIfscCode').textContent = data.ifscCode || 'N/A';
            document.getElementById('globalBeneficiaryMobile').textContent = data.beneficiaryMobile || 'N/A';
            document.getElementById('globalPayoutCountry').textContent = data.payoutCountry || 'N/A';
            document.getElementById('globalSource').textContent = data.source || 'N/A';
            document.getElementById('globalPurpose').textContent = data.purpose || 'N/A';
            document.getElementById('globalPayoutAmount').textContent = data.payoutAmount || 'N/A';
            document.getElementById('globalExchangeRate').textContent = data.exchangeRate || 'N/A';
            document.getElementById('globalPayInAmount').textContent = data.payInAmount || 'N/A';
            document.getElementById('globalServiceCharge').textContent = data.serviceCharge || 'N/A';
            document.getElementById('globalTotalAmount').textContent = `Total Amount: ${data.totalAmount || 'N/A'}`;

            document.getElementById('globalDownloadBtn').onclick = () => downloadReceiptGlobal(data);
        }

        function downloadReceiptGlobal(data) {
            const amountMatch = data.payoutAmount.match(/([\d,]+\.\d{2})/);
            const amount = amountMatch ? amountMatch[1].replace(',', '') : '2529000';
            const receiptUrl = `global_receipt.html?` + new URLSearchParams({
                bankName: data.bankName || 'N/A',
                accountNo: data.accountNo || 'N/A',
                beneficiaryName: data.beneficiaryName || 'N/A',
                beneficiaryMobile: data.beneficiaryMobile || 'N/A',
                senderName: data.senderName || 'N/A',
                amount: amount,
                payInAmount: data.payInAmount || 'N/A',
                serviceCharge: data.serviceCharge || 'N/A',
                totalAmount: data.totalAmount || 'N/A',
                exchangeRate: data.exchangeRate || 'N/A',
                txn: data.txnNo || 'N/A',
                ref: data.receiptNo || '73644H66088',
                referenceNumber: data.referenceNumber || 'N/A',
                date: data.date || 'N/A',
                routingNumber: data.routingNumber || 'N/A',
                branchName: data.branchName || 'N/A',
                payoutCountry: data.payoutCountry || 'N/A',
                paymentChannel: data.paymentChannel || 'N/A',
                pin: data.pin || 'N/A'
            }).toString();

            window.open(receiptUrl, '_blank');
        }

        // Indonesia Section
         const indonesiaFileInput = document.getElementById('indonesiaFileInput');
        const indonesiaFileNameDisplay = document.getElementById('indonesia');
        const indonesiaReceiptContainer = document.getElementById('indonesiaReceiptContainer');
        const indonesiaLoadingIndicator = document.getElementById('indonesiaLoading');
        const indonesiaDownloadBtn = document.getElementById('indonesiaDownloadBtn');
        const indonesiaResetBtn = document.getElementById('indonesiaResetBtn');
        const indonesiaCountryError = document.getElementById('indonesiaCountryError');

        indonesiaFileInput.addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;

            indonesiaFileNameDisplay.textContent = `Selected file: ${file.name}`;
            indonesiaLoadingIndicator.style.display = 'block';
            indonesiaCountryError.style.display = 'none';

            try {
                const extractedData = await extractDataFromPDFIndonesia(file);
                populateReceiptIndonesia(extractedData);
                indonesiaReceiptContainer.style.display = 'block';

                const isIndonesia = extractedData.payoutCountry && 
                                   (extractedData.payoutCountry.toLowerCase().includes('indonesia') || 
                                    extractedData.payoutCountry.toLowerCase().includes('indo'));

                updateHeaderFlag(extractedData.payoutCountry);

                if (isIndonesia) {
                    indonesiaDownloadBtn.disabled = false;
                    indonesiaDownloadBtn.title = 'Download Receipt';
                    indonesiaDownloadBtn.style.backgroundColor = '#3498db';
                } else {
                    indonesiaDownloadBtn.disabled = true;
                    indonesiaDownloadBtn.title = 'Receipt can only be downloaded for Indonesia payout country';
                    indonesiaDownloadBtn.style.backgroundColor = '#95a5a6';
                    indonesiaCountryError.style.display = 'block';
                }
            } catch (error) {
                console.error('Error processing Indonesia PDF:', error);
                let message = 'Error processing PDF. Please ensure it is a valid PDF and has the correct format.';
                if (error.message.includes('Invalid PDF')) {
                    message = 'The uploaded file is not a valid PDF.';
                } else if (error.message.includes('No text')) {
                    message = 'The PDF contains no extractable text.';
                }
                alert(message);
            } finally {
                indonesiaLoadingIndicator.style.display = 'none';
            }
        });

        indonesiaResetBtn.addEventListener('click', () => {
            indonesiaFileInput.value = '';
            indonesiaFileNameDisplay.textContent = 'No file selected';
            indonesiaReceiptContainer.style.display = 'none';
            indonesiaDownloadBtn.disabled = true;
            indonesiaDownloadBtn.style.backgroundColor = '#3498db';
            document.querySelectorAll('#indonesiaReceiptContainer .detail-value').forEach(el => el.textContent = '');
            document.getElementById('indonesiaTotalAmount').textContent = '';
            indonesiaCountryError.style.display = 'none';
            updateHeaderFlag('');
        });

        async function extractDataFromPDFIndonesia(file) {
            const arrayBuffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
            const page = await pdf.getPage(1);
            const textContent = await page.getTextContent();
            const textItems = textContent.items.map(item => item.str);
            
            let text = textItems.join('\n');
            text = text.replace(/\s*:\s*/g, ': ').replace(/\n\s+/g, '\n');
            
            console.log('Full extracted text (Indonesia):', text);
            
            const receiptNoMatch = text.match(/Receipt No: (\d+)/i);
            const paymentChannelMatch = text.match(/Payment Channel: ([^\n]+)/i);
            const dateMatch = text.match(/Date: ([^\n]+)/i);
            
            const senderSectionMatch = text.match(/Sender Details([\s\S]*?)Beneficary Details/i);
            let senderSection = senderSectionMatch ? senderSectionMatch[1] : '';
            console.log('Sender Section (Indonesia):', senderSection);
            
            const customerIdMatch = senderSection.match(/Customer Id: ([^\n]+)/i);
            const senderNameMatch = senderSection.match(/Name: ([^\n]+)/i);
            const senderAddressMatch = senderSection.match(/Address: ([\s\S]*?)(?=(?:National ID|Passport))/i);
            let senderAddress = 'N/A';
            let senderAddressRaw = 'N/A';
            if (senderAddressMatch) {
                senderAddressRaw = senderAddressMatch[1].trim();
                senderAddress = senderAddressRaw.replace(/\n/g, ', ').trim();
            }
            const nationalIdMatch = senderSection.match(/(?:National ID|Passport): ([^\n]+)/i);
            const nationalityMatch = senderSection.match(/Nationality: ([^\n]+)/i);
            const professionMatch = senderSection.match(/Profession: ([^\n]+)/i);
            const senderMobileMatch = senderSection.match(/Mobile No: (\d+)/i) || 
                                    senderSection.match(/Mobile\s*No: (\d+)/i);
            
            const senderName = senderNameMatch ? senderNameMatch[1].trim() : '';
            
            const beneficiarySectionMatch = text.match(/Beneficary Details([\s\S]*?)(?=Payout\s*(?:Amount|Country)|$)/i);
            let beneficiarySection = beneficiarySectionMatch ? beneficiarySectionMatch[1] : '';
            console.log('Beneficiary Section (Indonesia):', beneficiarySection);
            
            const lines = beneficiarySection.split('\n');
            let beneficiaryData = {
                name: '',
                bankName: '',
                accountNo: '',
                ifscCode: 'N/A',
                mobileNo: 'N/A'
            };
            
            let fieldIndex = 0;
            let lastAccountNo = '';
            let expectingValue = false;
            
            for (let i = 0; i < lines.length && fieldIndex < 5; i++) {
                let line = lines[i].trim();
                
                if (!line) continue;
                
                console.log(`Processing Beneficiary Line ${i} (fieldIndex=${fieldIndex}): ${line}`);
                
                if (expectingValue) {
                    if (fieldIndex === 0) {
                        const nameMatch = line.match(/^:?\s*([^\n]+)/);
                        if (nameMatch) {
                            beneficiaryData.name = nameMatch[1].trim();
                            fieldIndex++;
                            expectingValue = false;
                        }
                    }
                    continue;
                }
                
                if (fieldIndex === 0 && line.match(/Name/i) && !line.match(/:/)) {
                    expectingValue = true;
                } else if (fieldIndex === 0 && line.match(/Name:/i)) {
                    const nameMatch = line.match(/Name: ([^\n]+)/i);
                    if (nameMatch) {
                        beneficiaryData.name = nameMatch[1].trim();
                        fieldIndex++;
                    }
                } else if (fieldIndex === 1 && line.match(/(?:Bank|Bank Name):/i)) {
                    const bankMatch = line.match(/(?:Bank|Bank Name): ([^\n]+)/i);
                    if (bankMatch) {
                        beneficiaryData.bankName = bankMatch[1].trim();
                        fieldIndex++;
                    }
                } else if (fieldIndex === 1 && !line.match(/(?:Bank|Bank Name):/i) && line.match(/[A-Z\s]+/)) {
                    beneficiaryData.bankName = line.trim();
                    fieldIndex++;
                } else if (fieldIndex === 2 && line.match(/Account No:/i)) {
                    const accountMatch = line.match(/Account No: ([^\n]+)/i);
                    if (accountMatch) {
                        beneficiaryData.accountNo = accountMatch[1].trim();
                        lastAccountNo = beneficiaryData.accountNo;
                        fieldIndex++;
                    }
                } else if (fieldIndex === 2 && line.match(/\d+/)) {
                    beneficiaryData.accountNo = line.trim();
                    lastAccountNo = beneficiaryData.accountNo;
                    fieldIndex++;
                } else if (fieldIndex === 3 && line.match(/(?:IFSC(?:\/Bank)?\s*Code|Branch\s*Code|Bank\s*Code|IFSC):/i)) {
                    const ifscMatch = line.match(/(?:IFSC(?:\/Bank)?\s*Code|Branch\s*Code|Bank\s*Code|IFSC): ([^\n]+)/i);
                    if (ifscMatch) {
                        const potentialIfsc = ifscMatch[1].trim();
                        console.log(`Found potential IFSC code with label: ${potentialIfsc}`);
                        if (potentialIfsc !== lastAccountNo && potentialIfsc.length > 1 && !potentialIfsc.match(/mobile/i)) {
                            beneficiaryData.ifscCode = potentialIfsc;
                        } else {
                            console.log('IFSC code matches account number, is too short, or contains "mobile", keeping as N/A');
                        }
                        fieldIndex++;
                    }
                } else if (fieldIndex === 3 && !line.match(/(?:IFSC(?:\/Bank)?\s*Code|Branch\s*Code|Bank\s*Code|IFSC):/i)) {
                    const potentialIfsc = line.trim();
                    console.log(`Found potential IFSC code without label: ${potentialIfsc}`);
                    if (potentialIfsc !== lastAccountNo && potentialIfsc.length > 1 && !potentialIfsc.match(/mobile/i)) {
                        beneficiaryData.ifscCode = potentialIfsc;
                    } else {
                        console.log('Potential IFSC code matches account number, is too short, or contains "mobile", keeping as N/A');
                    }
                    fieldIndex++;
                } else if (fieldIndex === 4 && line.match(/Mobile No:/i)) {
                    const mobileMatch = line.match(/Mobile No: (\d+)/i);
                    if (mobileMatch) {
                        const potentialMobile = mobileMatch[1].trim();
                        console.log(`Found potential Mobile No with label: ${potentialMobile}`);
                        if (potentialMobile !== lastAccountNo && /^\d+$/.test(potentialMobile)) {
                            beneficiaryData.mobileNo = potentialMobile;
                        } else {
                            console.log('Mobile No matches account number or is not numeric, keeping as N/A');
                        }
                        fieldIndex++;
                    }
                } else if (fieldIndex === 4 && line.match(/\d+/)) {
                    const potentialMobile = line.trim();
                    console.log(`Found potential Mobile No without label: ${potentialMobile}`);
                    if (potentialMobile !== lastAccountNo && /^\d+$/.test(potentialMobile)) {
                        beneficiaryData.mobileNo = potentialMobile;
                    } else {
                        console.log('Potential Mobile No matches account number or is not numeric, keeping as N/A');
                    }
                    fieldIndex++;
                }
            }
            
            if (!beneficiaryData.name) {
                const nameMatch = text.match(/Beneficary Details[\s\S]*?Name[\s\S]*?: ([^\n]+)/i);
                if (nameMatch) {
                    beneficiaryData.name = nameMatch[1].trim();
                }
            }
            if (!beneficiaryData.bankName) {
                const bankMatch = text.match(/Beneficary Details[\s\S]*?(?:Bank|Bank Name): ([^\n]+)/i);
                beneficiaryData.bankName = bankMatch ? bankMatch[1].trim() : '';
            }
            if (!beneficiaryData.accountNo) {
                const accountMatch = text.match(/Beneficary Details[\s\S]*?Account No: ([^\n]+)/i);
                beneficiaryData.accountNo = accountMatch ? accountMatch[1].trim() : '';
            }
            if (beneficiaryData.ifscCode === 'N/A') {
                const ifscMatch = text.match(/Beneficary Details[\s\S]*?(?:IFSC(?:\/Bank)?\s*Code|Branch\s*Code|Bank\s*Code|IFSC): ([^\n]+)/i);
                if (ifscMatch) {
                    const potentialIfsc = ifscMatch[1].trim();
                    console.log(`Fallback IFSC code found: ${potentialIfsc}`);
                    if (potentialIfsc !== beneficiaryData.accountNo && potentialIfsc.length > 1 && !potentialIfsc.match(/mobile/i)) {
                        beneficiaryData.ifscCode = potentialIfsc;
                    } else {
                        console.log('Fallback IFSC code matches account number, is too short, or contains "mobile", keeping as N/A');
                    }
                }
            }
            if (beneficiaryData.mobileNo === 'N/A') {
                const mobileMatch = text.match(/Beneficary Details[\s\S]*?Mobile No: (\d+)/i);
                if (mobileMatch) {
                    const potentialMobile = mobileMatch[1].trim();
                    console.log(`Fallback Mobile No found: ${potentialMobile}`);
                    if (potentialMobile !== beneficiaryData.accountNo && /^\d+$/.test(potentialMobile)) {
                        beneficiaryData.mobileNo = potentialMobile;
                    }
                }
            }
            
            console.log('Extracted Beneficiary Data (Indonesia):', beneficiaryData);
            
            const paymentSectionMatch = text.match(/(?:Payout\s*(?:Amount|Country)|PayoutCountry)([\s\S]*)$/i);
            let paymentSection = paymentSectionMatch ? paymentSectionMatch[1] : text;
            console.log('Payment Section (Indonesia):', paymentSection);
            
            let payoutCountryMatch = paymentSection.match(/Payout Country: ([^\n]+)/i);
            if (!payoutCountryMatch) {
                payoutCountryMatch = paymentSection.match(/PayoutCountry: ([^\n]+)/i);
            }
            if (!payoutCountryMatch) {
                payoutCountryMatch = text.match(/Payout\s*Country: ([^\n]+)/i) || text.match(/PayoutCountry: ([^\n]+)/i);
            }
            
            const sourceMatch = paymentSection.match(/Source: ([^\n]+)/i);
            const purposeMatch = paymentSection.match(/Purpose: ([^\n]+)/i);
            const payoutAmountMatch = paymentSection.match(/([\d,]+\.\d{2})\s*([A-Z]{3})/i);
            const exchangeRateMatch = paymentSection.match(/Exchange Rate: ([\d.]+)\s*([A-Z]{3})/i);
            const payInAmountMatch = paymentSection.match(/Pay In Amount: ([\d,]+\.\d{2})\s*([A-Z]{3})/i);
            const serviceChargeMatch = paymentSection.match(/Service Charge: ([\d,]+\.\d{2})\s*([A-Z]{3})/i);
            const totalAmountMatch = paymentSection.match(/Total Amount: ([\d,]+\.\d{2})\s*([A-Z]{3})/i);
            
            const finalIfscCode = beneficiaryData.ifscCode && beneficiaryData.ifscCode.length > 1 && !beneficiaryData.ifscCode.match(/mobile/i) ? beneficiaryData.ifscCode : 'N/A';
            const finalMobileNo = beneficiaryData.mobileNo && /^\d+$/.test(beneficiaryData.mobileNo) ? beneficiaryData.mobileNo : 'N/A';
            
            const extractedData = {
                receiptNo: receiptNoMatch ? receiptNoMatch[1].trim() : 'N/A',
                paymentChannel: paymentChannelMatch ? paymentChannelMatch[1].trim() : 'N/A',
                date: dateMatch ? dateMatch[1].trim() : 'N/A',
                customerId: customerIdMatch ? customerIdMatch[1].trim() : 'N/A',
                senderName: senderNameMatch ? senderNameMatch[1].trim() : 'N/A',
                senderAddress: senderAddress,
                senderAddressRaw: senderAddressRaw,
                nationalId: nationalIdMatch ? nationalIdMatch[1].trim() : 'N/A',
                nationality: nationalityMatch ? nationalityMatch[1].trim() : 'N/A',
                profession: professionMatch ? professionMatch[1].trim() : 'N/A',
                senderMobile: senderMobileMatch ? senderMobileMatch[1].trim() : 'N/A',
                beneficiaryName: beneficiaryData.name || 'N/A',
                bankName: beneficiaryData.bankName || 'N/A',
                accountNo: beneficiaryData.accountNo || 'N/A',
                ifscCode: finalIfscCode,
                beneficiaryMobile: finalMobileNo,
                payoutCountry: payoutCountryMatch ? payoutCountryMatch[1].trim() : 'N/A',
                source: sourceMatch ? sourceMatch[1].trim() : 'N/A',
                purpose: purposeMatch ? purposeMatch[1].trim() : 'N/A',
                payoutAmount: payoutAmountMatch ? `${payoutAmountMatch[1].trim()} ${payoutAmountMatch[2]}` : 'N/A',
                exchangeRate: exchangeRateMatch ? `${exchangeRateMatch[1].trim()} ${exchangeRateMatch[2]}` : 'N/A',
                payInAmount: payInAmountMatch ? `${payInAmountMatch[1].trim()} ${payInAmountMatch[2]}` : 'N/A',
                serviceCharge: serviceChargeMatch ? `${serviceChargeMatch[1].trim()} ${serviceChargeMatch[2]}` : 'N/A',
                totalAmount: totalAmountMatch ? `${totalAmountMatch[1].trim()} ${totalAmountMatch[2]}` : 'N/A'
            };
            
            console.log('Extracted Data (Indonesia):', extractedData);
            return extractedData;
        }

        function populateReceiptIndonesia(data) {
            console.log('Data passed to UI (Indonesia):', data);
            document.getElementById('indonesiaCustomerId').textContent = data.customerId || 'N/A';
            document.getElementById('indonesiaSenderName').textContent = data.senderName || 'N/A';
            document.getElementById('indonesiaSenderAddress').innerHTML = (data.senderAddressRaw || 'N/A').replace(/\n/g, '<br>');
            document.getElementById('indonesiaNationalId').textContent = data.nationalId || 'N/A';
            document.getElementById('indonesiaNationality').textContent = data.nationality || 'N/A';
            document.getElementById('indonesiaProfession').textContent = data.profession || 'N/A';
            document.getElementById('indonesiaSenderMobile').textContent = data.senderMobile || 'N/A';
            document.getElementById('indonesiaBeneficiaryName').textContent = data.beneficiaryName || 'N/A';
            document.getElementById('indonesiaBankName').textContent = data.bankName || 'N/A';
            document.getElementById('indonesiaAccountNo').textContent = data.accountNo || 'N/A';
            document.getElementById('indonesiaIfscCode').textContent = data.ifscCode || 'N/A';
            document.getElementById('indonesiaBeneficiaryMobile').textContent = data.beneficiaryMobile || 'N/A';
            document.getElementById('indonesiaPayoutCountry').textContent = data.payoutCountry || 'N/A';
            document.getElementById('indonesiaSource').textContent = data.source || 'N/A';
            document.getElementById('indonesiaPurpose').textContent = data.purpose || 'N/A';
            document.getElementById('indonesiaPayoutAmount').textContent = data.payoutAmount || 'N/A';
            document.getElementById('indonesiaExchangeRate').textContent = data.exchangeRate || 'N/A';
            document.getElementById('indonesiaPayInAmount').textContent = data.payInAmount || 'N/A';
            document.getElementById('indonesiaServiceCharge').textContent = data.serviceCharge || 'N/A';
            document.getElementById('indonesiaTotalAmount').textContent = `Total Amount: ${data.totalAmount || 'N/A'}`;
            document.getElementById('indonesiaDownloadBtn').onclick = () => downloadReceiptIndonesia(data);
        }

        function downloadReceiptIndonesia(data) {
            const amountMatch = data.payoutAmount.match(/([\d,]+\.\d{2})/);
            const amount = amountMatch ? amountMatch[1].replace(',', '') : '2529000';
            const now = new Date();
            const bruneiTime = new Date(now.getTime() + (8 * 60 * 60 * 1000));
            const formattedDate = bruneiTime.toISOString().replace('T', ' ').replace(/\.\d+Z/, '') + ' BNT';
            
            const receiptUrl = 'indonesia_receipt.html?' + new URLSearchParams({
                date: formattedDate,
                bankName: data.bankName || 'BRI',
                accountNo: data.accountNo || 'N/A',
                beneficiaryName: data.beneficiaryName || 'N/A',
                amount: amount,
                ref: data.receiptNo || '73644H66088'
            }).toString();
            
            window.open(receiptUrl, '_blank');
        }

        // Bangladesh Section
          const bangladeshFileInput = document.getElementById('bangladeshFileInput');
        const bangladeshFileNameDisplay = document.getElementById('bangladeshFileName');
        const bangladeshReceiptContainer = document.getElementById('bangladeshReceiptContainer');
        const bangladeshLoadingIndicator = document.getElementById('bangladeshLoading');
        const bangladeshDownloadBtn = document.getElementById('bangladeshDownloadBtn');
        const bangladeshResetBtn = document.getElementById('bangladeshResetBtn');
        const bangladeshCountryError = document.getElementById('bangladeshCountryError');

        bangladeshFileInput.addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;
            bangladeshFileNameDisplay.textContent = `Selected file: ${file.name}`;
            bangladeshLoadingIndicator.style.display = 'block';
            bangladeshCountryError.style.display = 'none';
            try {
                const extractedData = await extractDataFromPDFBangladesh(file);
                populateReceiptBangladesh(extractedData);
                bangladeshReceiptContainer.style.display = 'block';
                if (extractedData.destinationCountry.toLowerCase().includes('bangladesh')) {
                    bangladeshDownloadBtn.disabled = false;
                    bangladeshDownloadBtn.title = 'Download Receipt';
                    bangladeshDownloadBtn.style.backgroundColor = '#3498db';
                } else {
                    bangladeshDownloadBtn.disabled = true;
                    bangladeshDownloadBtn.title = 'Receipt can only be downloaded for Bangladesh payout country';
                    bangladeshDownloadBtn.style.backgroundColor = '#95a5a6';
                    bangladeshCountryError.style.display = 'block';
                }
            } catch (error) {
                console.error('Error processing Bangladesh PDF:', error);
                alert('Error processing PDF. Please ensure it is a valid PDF.');
            } finally {
                bangladeshLoadingIndicator.style.display = 'none';
            }
        });

        bangladeshResetBtn.addEventListener('click', () => {
            bangladeshFileInput.value = '';
            bangladeshFileNameDisplay.textContent = 'No file selected';
            bangladeshReceiptContainer.style.display = 'none';
            bangladeshDownloadBtn.disabled = true;
            bangladeshDownloadBtn.style.backgroundColor = '#3498db';
            document.querySelectorAll('#bangladeshReceiptContainer .detail-value').forEach(el => el.textContent = '');
            document.getElementById('bangladeshTotalPaid').textContent = '';
            bangladeshCountryError.style.display = 'none';
        });

        async function extractDataFromPDFBangladesh(file) {
            const arrayBuffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
            const page = await pdf.getPage(1);
            const textContent = await page.getTextContent();
            const text = textContent.items.map(item => item.str).join('\n').replace(/\s*:\s*/g, ': ').replace(/,\s*,/g, ',');

            console.log('Full extracted text (Bangladesh):', text);

            // Transaction Details
            const refNoMatch = text.match(/Receipt No\.?\s*([A-Za-z0-9-]+)/i) || text.match(/Ref No: ([^\n]+)/i);
            const dateMatch = text.match(/Date: (\d{1,2}\s+[A-Za-z]+\s+\d{4})/i);

            // Sender Details
            const senderNameMatch = text.match(/Sender Name: ([^\n]+)/i);
            const passportNoMatch = text.match(/Sender Passport No: ([^\n]+)/i);
            const icNoMatch = text.match(/Sender IC No: ([^\n]+)/i);
            const senderAddressMatch = text.match(/Sender Address: ([\s\S]*?)(?=(?:Sender Citizenship|Sender Mobile No|$))/i);
            const citizenshipMatch = text.match(/Sender Citizenship: ([^\n]+)/i);
            const senderMobileMatch = text.match(/Sender Mobile No: (\+?\d+)/i);

            // Beneficiary Details
            const beneficiaryNameMatch = text.match(/Beneficiary Name: ([^\n]+)/i);
            const beneficiaryMobileMatch = text.match(/Beneficiary Mobile No: (\+?\d+)/i);
            const bankNameMatch = text.match(/Beneficiary Bank Name: ([^\n]+)/i);
            const accountNoMatch = text.match(/Beneficiary Account No: ([^\n]+)/i);
            const bankBranchMatch = text.match(/Beneficiary Bank Branch: ([^\n]+)/i);
            const ifscRoutingNoMatch = text.match(/IFSC \/ Routing No: ([^\n]+)/i);

            // Payment Details
            const paymentChannelMatch = text.match(/Payment Channel: ([^\n]+)/i);
            const cashPickupAtMatch = text.match(/Cash Pick\s*-?\s*up at: ([^\n]+)/i);
            const payoutCodeMatch = text.match(/Payout Code: ([\d-]+)/i) || text.match(/([\d-]{3,}-\d{3,}-\d{3,})/i);
            const sourceMatch = text.match(/Source: ([^\n]+)/i);
            const purposeMatch = text.match(/Purpose: ([^\n]+)/i);
            const destinationCountryMatch = text.match(/Destination Country: ([^\n]+)/i);
            const payoutAmountMatch = text.match(/Payout Amount to Beneficiary: ([\d,]+\.\d{2})/i);
            const exchangeRateMatch = text.match(/Exchange Rate: ([\d.]+)/i);
            const sendAmountMatch = text.match(/Send Amount in BND: BND([\d,]+\.\d{2})/i);
            const serviceFeeMatch = text.match(/\n\s*SERVICE FEE\s*([\d,]+\.\d{2})/i);
            const totalMatch = text.match(/Total\s*BND([\d,]+\.\d{2})/i);

            // Format IC No by removing special characters and spaces
            const icNoRaw = icNoMatch ? icNoMatch[1].trim() : 'N/A';
            const icNoFormatted = icNoRaw.replace(/[^a-zA-Z0-9]/g, '');

            // Format Sender Address
            let senderAddress = 'N/A';
            if (senderAddressMatch) {
                senderAddress = senderAddressMatch[1].trim().replace(/\n/g, ', ').replace(/,\s*,/g, ',');
            }

            // Parse Send Amount and Service Fee for total calculation
            const sendAmountValue = sendAmountMatch ? parseFloat(sendAmountMatch[1].replace(',', '')) : 0;
            const serviceFeeValue = serviceFeeMatch ? parseFloat(serviceFeeMatch[1].replace(',', '')) : 0;
            const totalPaidValue = totalMatch ? parseFloat(totalMatch[1].replace(',', '')) : (sendAmountValue + serviceFeeValue);
            const totalPaidFormatted = totalPaidValue.toFixed(2);

            const extractedData = {
                refNo: refNoMatch ? refNoMatch[1].trim() : 'N/A',
                date: dateMatch ? dateMatch[1].trim() : 'N/A',
                senderName: senderNameMatch ? senderNameMatch[1].trim() : 'N/A',
                passportNo: passportNoMatch ? passportNoMatch[1].trim() : 'N/A',
                icNo: icNoFormatted,
                senderAddress: senderAddress,
                citizenship: citizenshipMatch ? citizenshipMatch[1].trim() : 'N/A',
                senderMobile: senderMobileMatch ? senderMobileMatch[1].trim() : 'N/A',
                beneficiaryName: beneficiaryNameMatch ? beneficiaryNameMatch[1].trim() : 'N/A',
                beneficiaryMobile: beneficiaryMobileMatch ? beneficiaryMobileMatch[1].trim() : 'N/A',
                bankName: bankNameMatch ? bankNameMatch[1].trim() : 'N/A',
                accountNo: accountNoMatch ? accountNoMatch[1].trim() : 'N/A',
                bankBranch: bankBranchMatch ? bankBranchMatch[1].trim() : 'N/A',
                ifscRoutingNo: ifscRoutingNoMatch ? ifscRoutingNoMatch[1].trim() : 'N/A',
                paymentChannel: paymentChannelMatch ? paymentChannelMatch[1].trim() : 'N/A',
                cashPickupAt: cashPickupAtMatch ? cashPickupAtMatch[1].trim() : 'N/A',
                payoutCode: payoutCodeMatch ? payoutCodeMatch[1].trim() : 'N/A',
                source: sourceMatch ? sourceMatch[1].trim() : 'N/A',
                purpose: purposeMatch ? purposeMatch[1].trim() : 'N/A',
                destinationCountry: destinationCountryMatch ? destinationCountryMatch[1].trim() : 'N/A',
                payoutAmount: payoutAmountMatch ? `${payoutAmountMatch[1]} BDT` : 'N/A',
                exchangeRate: exchangeRateMatch ? `${exchangeRateMatch[1]}` : 'N/A',
                sendAmount: sendAmountMatch ? `${sendAmountMatch[1]} BND` : 'N/A',
                serviceFee: serviceFeeMatch ? `${serviceFeeMatch[1]} BND` : 'N/A',
                totalPaid: `${totalPaidFormatted} BND`
            };

            console.log('Extracted Data (Bangladesh):', extractedData);
            return extractedData;
        }

        function populateReceiptBangladesh(data) {
            document.getElementById('bangladeshRefNo').textContent = data.refNo;
            document.getElementById('bangladeshDate').textContent = data.date;
            document.getElementById('bangladeshSenderName').textContent = data.senderName;
            document.getElementById('bangladeshPassportNo').textContent = data.passportNo;
            document.getElementById('bangladeshIcNo').textContent = data.icNo;
            document.getElementById('bangladeshSenderAddress').innerHTML = data.senderAddress.replace(/, /g, '<br>');
            document.getElementById('bangladeshCitizenship').textContent = data.citizenship;
            document.getElementById('bangladeshSenderMobile').textContent = data.senderMobile;
            document.getElementById('bangladeshBeneficiaryName').textContent = data.beneficiaryName;
            document.getElementById('bangladeshBeneficiaryMobile').textContent = data.beneficiaryMobile;
            document.getElementById('bangladeshBankName').textContent = data.bankName;
            document.getElementById('bangladeshAccountNo').textContent = data.accountNo;
            document.getElementById('bangladeshBankBranch').textContent = data.bankBranch;
            document.getElementById('bangladeshIfscRoutingNo').textContent = data.ifscRoutingNo;
            document.getElementById('bangladeshPaymentChannel').textContent = data.paymentChannel;
            document.getElementById('bangladeshCashPickupAt').textContent = data.cashPickupAt;
            document.getElementById('bangladeshPayoutCode').textContent = data.payoutCode;
            document.getElementById('bangladeshSource').textContent = data.source;
            document.getElementById('bangladeshPurpose').textContent = data.purpose;
            document.getElementById('bangladeshDestinationCountry').textContent = data.destinationCountry;
            document.getElementById('bangladeshPayoutAmount').textContent = data.payoutAmount;
            document.getElementById('bangladeshExchangeRate').textContent = data.exchangeRate;
            document.getElementById('bangladeshSendAmount').textContent = data.sendAmount;
            document.getElementById('bangladeshServiceFee').textContent = data.serviceFee;
            document.getElementById('bangladeshTotalPaid').textContent = `Total Paid in BND: ${data.totalPaid}`;
            document.getElementById('bangladeshDownloadBtn').onclick = () => downloadReceiptBangladesh(data);
        }

        function downloadReceiptBangladesh(data) {
            const amount = data.payoutAmount.match(/([\d,]+\.\d{2})/)?.[1].replace(',', '') || '138900.00';
            const now = new Date();
            const bruneiTime = new Date(now.getTime() + (8 * 60 * 60 * 1000)); // Adjust to Brunei time (UTC+8)
            const formattedDate = bruneiTime.toISOString().replace('T', ' ').replace(/\.\d+Z/, '') + ' BNT';

            const receiptUrl = 'bangladesh_receipt.html?' + new URLSearchParams({
                date: formattedDate,
                bankName: data.bankName,
                accountNo: data.accountNo,
                beneficiaryName: data.beneficiaryName,
                beneficiaryMobile: data.beneficiaryMobile,
                senderName: data.senderName,
                senderMobile: data.senderMobile,
                amount: amount,
                ref: data.refNo,
                payoutCode: data.payoutCode,
                exchangeRate: data.exchangeRate,
                payoutAmount: data.payoutAmount,
                sendAmount: data.sendAmount,
                serviceFee: data.serviceFee,
                totalPaid: data.totalPaid
            }).toString();

            window.open(receiptUrl, '_blank');
        }

        // Platinum Section (Updated to match website 2 design)
        const platinumFileInput = document.getElementById('platinumFileInput');
        const platinumFileNameDisplay = document.getElementById('platinumFileName');
        const platinumReceiptContainer = document.getElementById('platinumReceiptContainer');
        const platinumLoadingIndicator = document.getElementById('platinumLoading');
        const platinumDownloadBtn = document.getElementById('platinumDownloadBtn');
        const platinumResetBtn = document.getElementById('platinumResetBtn');
        const platinumCountryError = document.getElementById('platinumCountryError');

        platinumFileInput.addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;

            platinumFileNameDisplay.textContent = `Selected file: ${file.name}`;
            platinumLoadingIndicator.style.display = 'block';
            platinumCountryError.style.display = 'none';

            try {
                const extractedData = await extractDataFromPDFPlatinum(file);
                populateReceiptPlatinum(extractedData);
                platinumReceiptContainer.style.display = 'block';

                updateHeaderFlag(extractedData.payoutCountry);

                platinumDownloadBtn.disabled = false;
                platinumDownloadBtn.title = 'Download Receipt';
                platinumDownloadBtn.style.backgroundColor = '#3498db';
            } catch (error) {
                console.error('Error processing Platinum PDF:', error);
                let message = 'Error processing PDF. Please ensure it is a valid PDF and has the correct format.';
                if (error.message.includes('Invalid PDF')) {
                    message = 'The uploaded file is not a valid PDF.';
                } else if (error.message.includes('No text')) {
                    message = 'The PDF contains no extractable text.';
                }
                alert(message);
                platinumDownloadBtn.disabled = true;
                platinumDownloadBtn.title = 'Upload a valid PDF to enable download';
                platinumDownloadBtn.style.backgroundColor = '#95a5a6';
                platinumCountryError.style.display = 'block';
                platinumCountryError.textContent = message;
            } finally {
                platinumLoadingIndicator.style.display = 'none';
            }
        });

        platinumResetBtn.addEventListener('click', () => {
            platinumFileInput.value = '';
            platinumFileNameDisplay.textContent = 'No file selected';
            platinumReceiptContainer.style.display = 'none';
            platinumDownloadBtn.disabled = true;
            platinumDownloadBtn.style.backgroundColor = '#3498db';
            document.querySelectorAll('#platinumReceiptContainer .detail-value').forEach(el => el.textContent = '');
            document.getElementById('platinumTotalAmount').textContent = '';
            platinumCountryError.style.display = 'none';
            updateHeaderFlag('');
        });

        async function extractDataFromPDFPlatinum(file) {
            const arrayBuffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
            const page = await pdf.getPage(1);
            const textContent = await page.getTextContent();
            const textItems = textContent.items.map(item => item.str);
            
            // Join text items with line breaks to preserve structure
            let text = textItems.join('\n');
            
            // Normalize text to handle inconsistent spacing
            text = text.replace(/\s*:\s*/g, ': ').replace(/\n\s+/g, '\n');
            
            // Log the full text for debugging
            console.log('Full extracted text (Platinum):', text);
            
            // Extract receipt metadata - Enhanced to capture both Txn No and Receipt No
            const topLeftDateMatch = text.match(/^\d{1,2}\/\d{1,2}\/\d{2},\s*\d{1,2}:\d{2}\s*(?:AM|PM)/im);
            
            // Try multiple patterns for transaction/receipt number
            let txnNo = 'N/A';
            let txnNoMatch = null;
            
            // Pattern 1: Txn No with optional colon and spaces
            txnNoMatch = text.match(/Txn\s*No\.?\s*:?\s*(\d+)/i);
            if (txnNoMatch) {
                txnNo = txnNoMatch[1].trim();
                console.log('Found Txn No:', txnNo);
            }
            
            // Pattern 2: Receipt No with optional colon and spaces
            if (!txnNoMatch || txnNo === 'N/A') {
                txnNoMatch = text.match(/Receipt\s*No\.?\s*:?\s*(\d+)/i);
                if (txnNoMatch) {
                    txnNo = txnNoMatch[1].trim();
                    console.log('Found Receipt No:', txnNo);
                }
            }
            
            // Pattern 3: Transaction No with optional colon and spaces
            if (!txnNoMatch || txnNo === 'N/A') {
                txnNoMatch = text.match(/Transaction\s*No\.?\s*:?\s*(\d+)/i);
                if (txnNoMatch) {
                    txnNo = txnNoMatch[1].trim();
                    console.log('Found Transaction No:', txnNo);
                }
            }
            
            // Pattern 4: Ref No with optional colon and spaces
            if (!txnNoMatch || txnNo === 'N/A') {
                txnNoMatch = text.match(/Ref(?:erence)?\s*No\.?\s*:?\s*([A-Za-z0-9]+)/i);
                if (txnNoMatch) {
                    txnNo = txnNoMatch[1].trim();
                    console.log('Found Ref No:', txnNo);
                }
            }
            
            // Pattern 5: Generic number pattern near the top of document
            if (!txnNoMatch || txnNo === 'N/A') {
                const lines = text.split('\n');
                for (let i = 0; i < Math.min(10, lines.length); i++) {
                    const line = lines[i].trim();
                    // Look for standalone number that might be a transaction number
                    if (/^\d{6,}$/.test(line)) {
                        txnNo = line;
                        console.log('Found potential transaction number from pattern:', txnNo);
                        break;
                    }
                }
            }
            
            console.log('Final Transaction Number:', txnNo);
            
            const paymentChannelMatch = text.match(/Payment Channel: ([^\n]+)/i);
            const pinMatch = text.match(/(?:^|\n)\s*Pin\s*:+\s*([A-Za-z0-9]+)/i);
            const dateMatch = text.match(/Date: (\d{2}-\d{2}-\d{4})/i);
            
            // Log Pin extraction for debugging
            console.log('Pin Match:', pinMatch);
            
            // Extract sender details
            const senderSectionMatch = text.match(/Sender Details([\s\S]*?)Beneficary Details/i);
            let senderSection = senderSectionMatch ? senderSectionMatch[1] : '';
            console.log('Sender Section (Platinum):', senderSection);
            
            const customerIdMatch = senderSection.match(/Customer Id: ([^\n]+)/i);
            const senderNameMatch = senderSection.match(/Name: ([^\n]+)/i);
            const senderAddressMatch = senderSection.match(/Address: ([\s\S]*?)(?=(?:National ID|Passport))/i);
            let senderAddress = 'N/A';
            let senderAddressRaw = 'N/A';
            if (senderAddressMatch) {
                senderAddressRaw = senderAddressMatch[1].trim();
                senderAddress = senderAddressRaw.replace(/\n/g, ', ').trim();
            }
            const nationalIdMatch = senderSection.match(/(?:National ID|Passport): ([^\n]+)/i);
            const nationalityMatch = senderSection.match(/Nationality: ([^\n]+)/i);
            const professionMatch = senderSection.match(/Profession: ([^\n]+)/i);
            const senderMobileMatch = senderSection.match(/Mobile No: (\d+)/i) || 
                                    senderSection.match(/Mobile\s*No: (\d+)/i);
            
            const senderName = senderNameMatch ? senderNameMatch[1].trim() : '';
            
            // Extract beneficiary details
            const beneficiarySectionMatch = text.match(/Beneficary Details([\s\S]*?)(?=Payout\s*(?:Amount|Country)|$)/i);
            let beneficiarySection = beneficiarySectionMatch ? beneficiarySectionMatch[1] : '';
            console.log('Beneficiary Section (Platinum):', beneficiarySection);
            
            const lines = beneficiarySection.split('\n');
            let beneficiaryData = {
                name: '',
                bankName: '',
                accountNo: '',
                ifscCode: 'N/A',
                routingNumber: 'N/A',
                branchName: 'N/A',
                mobileNo: 'N/A'
            };
            
            let fieldIndex = 0;
            let lastAccountNo = '';
            let expectingValue = false;
            
            for (let i = 0; i < lines.length && fieldIndex < 5; i++) {
                let line = lines[i].trim();
                
                if (!line) continue;
                
                console.log(`Processing Beneficiary Line ${i} (fieldIndex=${fieldIndex}): ${line}`);
                
                if (expectingValue) {
                    if (fieldIndex === 0) {
                        const nameMatch = line.match(/^:?\s*([^\n]+)/);
                        if (nameMatch) {
                            beneficiaryData.name = nameMatch[1].trim();
                            fieldIndex++;
                            expectingValue = false;
                        }
                    }
                    continue;
                }
                
                if (fieldIndex === 0 && line.match(/Name/i) && !line.match(/:/)) {
                    expectingValue = true;
                } else if (fieldIndex === 0 && line.match(/Name:/i)) {
                    const nameMatch = line.match(/Name: ([^\n]+)/i);
                    if (nameMatch) {
                        beneficiaryData.name = nameMatch[1].trim();
                        fieldIndex++;
                    }
                } else if (fieldIndex === 1 && line.match(/(?:Bank|Bank Name):/i)) {
                    const bankMatch = line.match(/(?:Bank|Bank Name): ([^\n]+)/i);
                    if (bankMatch) {
                        beneficiaryData.bankName = bankMatch[1].trim();
                        fieldIndex++;
                    }
                } else if (fieldIndex === 1 && !line.match(/(?:Bank|Bank Name):/i) && line.match(/[A-Z\s]+/)) {
                    beneficiaryData.bankName = line.trim();
                    fieldIndex++;
                } else if (fieldIndex === 2 && line.match(/Account No:/i)) {
                    const accountMatch = line.match(/Account No: ([^\n]+)/i);
                    if (accountMatch) {
                        beneficiaryData.accountNo = accountMatch[1].trim();
                        lastAccountNo = beneficiaryData.accountNo;
                        fieldIndex++;
                    }
                } else if (fieldIndex === 2 && line.match(/\d+/)) {
                    beneficiaryData.accountNo = line.trim();
                    lastAccountNo = beneficiaryData.accountNo;
                    fieldIndex++;
                } else if (fieldIndex === 3 && line.match(/(?:IFSC(?:\/Bank)?\s*Code|Branch\s*Code|Bank\s*Code|IFSC):/i)) {
                    const ifscMatch = line.match(/(?:IFSC(?:\/Bank)?\s*Code|Branch\s*Code|Bank\s*Code|IFSC): ([^\n]+)/i);
                    if (ifscMatch) {
                        const potentialIfsc = ifscMatch[1].trim();
                        console.log(`Found potential IFSC code with label: ${potentialIfsc}`);
                        if (potentialIfsc !== lastAccountNo && potentialIfsc.length > 1 && !potentialIfsc.match(/mobile/i)) {
                            beneficiaryData.ifscCode = potentialIfsc;
                            // Split IFSC/Bank Code into branch name and routing number
                            const ifscParts = potentialIfsc.split(/\s+/);
                            if (ifscParts.length >= 2) {
                                // The last part is the routing number
                                beneficiaryData.routingNumber = ifscParts[ifscParts.length - 1];
                                // Everything before the last part is the branch name
                                beneficiaryData.branchName = ifscParts.slice(0, -1).join(' ');
                            }
                        } else {
                            console.log('IFSC code matches account number, is too short, or contains "mobile", keeping as N/A');
                        }
                        fieldIndex++;
                    }
                } else if (fieldIndex === 3 && !line.match(/(?:IFSC(?:\/Bank)?\s*Code|Branch\s*Code|Bank\s*Code|IFSC):/i)) {
                    const potentialIfsc = line.trim();
                    console.log(`Found potential IFSC code without label: ${potentialIfsc}`);
                    if (potentialIfsc !== lastAccountNo && potentialIfsc.length > 1 && !potentialIfsc.match(/mobile/i)) {
                        beneficiaryData.ifscCode = potentialIfsc;
                        // Split IFSC/Bank Code into branch name and routing number
                        const ifscParts = potentialIfsc.split(/\s+/);
                        if (ifscParts.length >= 2) {
                            beneficiaryData.routingNumber = ifscParts[ifscParts.length - 1];
                            beneficiaryData.branchName = ifscParts.slice(0, -1).join(' ');
                        }
                    } else {
                        console.log('Potential IFSC code matches account number, is too short, or contains "mobile", keeping as N/A');
                    }
                    fieldIndex++;
                } else if (fieldIndex === 4 && line.match(/Mobile No:/i)) {
                    const mobileMatch = line.match(/Mobile No: (\d+)/i);
                    if (mobileMatch) {
                        const potentialMobile = mobileMatch[1].trim();
                        console.log(`Found potential Mobile No with label: ${potentialMobile}`);
                        if (potentialMobile !== lastAccountNo && /^\d+$/.test(potentialMobile)) {
                            beneficiaryData.mobileNo = potentialMobile;
                        } else {
                            console.log('Mobile No matches account number or is not numeric, keeping as N/A');
                        }
                        fieldIndex++;
                    }
                } else if (fieldIndex === 4 && line.match(/\d+/)) {
                    const potentialMobile = line.trim();
                    console.log(`Found potential Mobile No without label: ${potentialMobile}`);
                    if (potentialMobile !== lastAccountNo && /^\d+$/.test(potentialMobile)) {
                        beneficiaryData.mobileNo = potentialMobile;
                    } else {
                        console.log('Potential Mobile No matches account number or is not numeric, keeping as N/A');
                    }
                    fieldIndex++;
                }
            }
            
            if (!beneficiaryData.name) {
                const nameMatch = text.match(/Beneficary Details[\s\S]*?Name[\s\S]*?: ([^\n]+)/i);
                if (nameMatch) {
                    beneficiaryData.name = nameMatch[1].trim();
                }
            }
            if (!beneficiaryData.bankName) {
                const bankMatch = text.match(/Beneficary Details[\s\S]*?(?:Bank|Bank Name): ([^\n]+)/i);
                beneficiaryData.bankName = bankMatch ? bankMatch[1].trim() : '';
            }
            if (!beneficiaryData.accountNo) {
                const accountMatch = text.match(/Beneficary Details[\s\S]*?Account No: ([^\n]+)/i);
                beneficiaryData.accountNo = accountMatch ? accountMatch[1].trim() : '';
            }
            if (beneficiaryData.ifscCode === 'N/A') {
                const ifscMatch = text.match(/Beneficary Details[\s\S]*?(?:IFSC(?:\/Bank)?\s*Code|Branch\s*Code|Bank\s*Code|IFSC): ([^\n]+)/i);
                if (ifscMatch) {
                    const potentialIfsc = ifscMatch[1].trim();
                    console.log(`Fallback IFSC code found: ${potentialIfsc}`);
                    if (potentialIfsc !== beneficiaryData.accountNo && potentialIfsc.length > 1 && !potentialIfsc.match(/mobile/i)) {
                        beneficiaryData.ifscCode = potentialIfsc;
                        const ifscParts = potentialIfsc.split(/\s+/);
                        if (ifscParts.length >= 2) {
                            beneficiaryData.routingNumber = ifscParts[ifscParts.length - 1];
                            beneficiaryData.branchName = ifscParts.slice(0, -1).join(' ');
                        }
                    } else {
                        console.log('Fallback IFSC code matches account number, is too short, or contains "mobile", keeping as N/A');
                    }
                }
            }
            if (beneficiaryData.mobileNo === 'N/A') {
                const mobileMatch = text.match(/Beneficary Details[\s\S]*?Mobile No: (\d+)/i);
                if (mobileMatch) {
                    const potentialMobile = mobileMatch[1].trim();
                    console.log(`Fallback Mobile No found: ${potentialMobile}`);
                    if (potentialMobile !== beneficiaryData.accountNo && /^\d+$/.test(potentialMobile)) {
                        beneficiaryData.mobileNo = potentialMobile;
                    }
                }
            }
            
            console.log('Extracted Beneficiary Data (Platinum):', beneficiaryData);
            
            const paymentSectionMatch = text.match(/(?:Payout\s*(?:Amount|Country)|PayoutCountry)([\s\S]*)$/i);
            let paymentSection = paymentSectionMatch ? paymentSectionMatch[1] : text;
            console.log('Payment Section (Platinum):', paymentSection);
            
            let payoutCountryMatch = paymentSection.match(/Payout Country: ([^\n]+)/i);
            if (!payoutCountryMatch) {
                payoutCountryMatch = paymentSection.match(/PayoutCountry: ([^\n]+)/i);
            }
            if (!payoutCountryMatch) {
                payoutCountryMatch = text.match(/Payout\s*Country: ([^\n]+)/i) || text.match(/PayoutCountry: ([^\n]+)/i);
            }
            
            const sourceMatch = paymentSection.match(/Source: ([^\n]+)/i);
            const purposeMatch = paymentSection.match(/Purpose: ([^\n]+)/i);
            const payoutAmountMatch = paymentSection.match(/([\d,]+\.\d{2})\s*([A-Z]{3})/i);
            const exchangeRateMatch = paymentSection.match(/Exchange Rate: ([\d.]+)\s*([A-Z]{3})/i);
            const payInAmountMatch = paymentSection.match(/Pay In Amount: ([\d,]+\.\d{2})\s*([A-Z]{3})/i);
            const serviceChargeMatch = paymentSection.match(/Service Charge: ([\d,]+\.\d{2})\s*([A-Z]{3})/i);
            const totalAmountMatch = paymentSection.match(/Total Amount: ([\d,]+\.\d{2})\s*([A-Z]{3})/i);
            
            const finalIfscCode = beneficiaryData.ifscCode && beneficiaryData.ifscCode.length > 1 && !beneficiaryData.ifscCode.match(/mobile/i) ? beneficiaryData.ifscCode : 'N/A';
            const finalMobileNo = beneficiaryData.mobileNo && /^\d+$/.test(beneficiaryData.mobileNo) ? beneficiaryData.mobileNo : 'N/A';
            
            const extractedData = {
                txnNo: txnNo,
                topLeftDate: topLeftDateMatch ? topLeftDateMatch[0].trim() : 'N/A',
                paymentChannel: paymentChannelMatch ? paymentChannelMatch[1].trim() : 'N/A',
                pin: pinMatch ? pinMatch[1].trim() : 'N/A',
                date: dateMatch ? dateMatch[1].trim() : 'N/A',
                
                customerId: customerIdMatch ? customerIdMatch[1].trim() : 'N/A',
                senderName: senderNameMatch ? senderNameMatch[1].trim() : 'N/A',
                senderAddress: senderAddress,
                senderAddressRaw: senderAddressRaw,
                nationalId: nationalIdMatch ? nationalIdMatch[1].trim() : 'N/A',
                nationality: nationalityMatch ? nationalityMatch[1].trim() : 'N/A',
                profession: professionMatch ? professionMatch[1].trim() : 'N/A',
                senderMobile: senderMobileMatch ? senderMobileMatch[1].trim() : 'N/A',
                
                beneficiaryName: beneficiaryData.name || 'N/A',
                bankName: beneficiaryData.bankName || 'N/A',
                accountNo: beneficiaryData.accountNo || 'N/A',
                ifscCode: finalIfscCode,
                routingNumber: beneficiaryData.routingNumber || 'N/A',
                branchName: beneficiaryData.branchName || 'N/A',
                beneficiaryMobile: finalMobileNo,
                
                payoutCountry: payoutCountryMatch ? payoutCountryMatch[1].trim() : 'N/A',
                source: sourceMatch ? sourceMatch[1].trim() : 'N/A',
                purpose: purposeMatch ? purposeMatch[1].trim() : 'N/A',
                payoutAmount: payoutAmountMatch ? `${payoutAmountMatch[1].trim()} ${payoutAmountMatch[2]}` : 'N/A',
                exchangeRate: exchangeRateMatch ? `${exchangeRateMatch[1].trim()} ${exchangeRateMatch[2]}` : 'N/A',
                payInAmount: payInAmountMatch ? `${payInAmountMatch[1].trim()} ${payInAmountMatch[2]}` : 'N/A',
                serviceCharge: serviceChargeMatch ? `${serviceChargeMatch[1].trim()} ${serviceChargeMatch[2]}` : 'N/A',
                totalAmount: totalAmountMatch ? `${totalAmountMatch[1].trim()} ${totalAmountMatch[2]}` : 'N/A'
            };
            
            console.log('Extracted Data (Platinum):', extractedData);
            return extractedData;
        }
        
        function populateReceiptPlatinum(data) {
            console.log('Data passed to UI (Platinum):', data);
            
            document.getElementById('platinumTxnNo').textContent = data.txnNo || 'N/A';
            document.getElementById('platinumDate').textContent = data.date || 'N/A';

            document.getElementById('platinumPaymentChannel').textContent = data.paymentChannel || 'N/A';
            document.getElementById('platinumPin').textContent = data.pin || 'N/A';

            document.getElementById('platinumCustomerId').textContent = data.customerId || 'N/A';
            document.getElementById('platinumSenderName').textContent = data.senderName || 'N/A';
            document.getElementById('platinumSenderAddress').innerHTML = (data.senderAddressRaw || 'N/A').replace(/\n/g, '<br>');
            document.getElementById('platinumNationalId').textContent = data.nationalId || 'N/A';
            document.getElementById('platinumNationality').textContent = data.nationality || 'N/A';
            document.getElementById('platinumProfession').textContent = data.profession || 'N/A';
            document.getElementById('platinumSenderMobile').textContent = data.senderMobile || 'N/A';
            
            document.getElementById('platinumBeneficiaryName').textContent = data.beneficiaryName || 'N/A';
            document.getElementById('platinumBankName').textContent = data.bankName || 'N/A';
            document.getElementById('platinumAccountNo').textContent = data.accountNo || 'N/A';
            document.getElementById('platinumIfscCode').textContent = data.ifscCode || 'N/A';
            document.getElementById('platinumBeneficiaryMobile').textContent = data.beneficiaryMobile || 'N/A';
            
            document.getElementById('platinumPayoutCountry').textContent = data.payoutCountry || 'N/A';
            document.getElementById('platinumSource').textContent = data.source || 'N/A';
            document.getElementById('platinumPurpose').textContent = data.purpose || 'N/A';
            document.getElementById('platinumPayoutAmount').textContent = data.payoutAmount || 'N/A';
            document.getElementById('platinumExchangeRate').textContent = data.exchangeRate || 'N/A';
            document.getElementById('platinumPayInAmount').textContent = data.payInAmount || 'N/A';
            document.getElementById('platinumServiceCharge').textContent = data.serviceCharge || 'N/A';
            document.getElementById('platinumTotalAmount').textContent = `Total Amount: ${data.totalAmount || 'N/A'}`;
            
            document.getElementById('platinumDownloadBtn').onclick = () => downloadReceiptPlatinum(data);
        }
        
        function downloadReceiptPlatinum(data) {
            const amountMatch = data.payoutAmount.match(/([\d,]+\.\d{2})/);
            const amount = amountMatch ? amountMatch[1].replace(',', '') : '2529000';
            
            // Use a single receipt.html and pass the payoutCountry and paymentChannel as parameters
            const receiptUrl = `receipt.html?` + new URLSearchParams({
                bankName: data.bankName || 'N/A',
                accountNo: data.accountNo || 'N/A',
                beneficiaryName: data.beneficiaryName || 'N/A',
                beneficiaryMobile: data.beneficiaryMobile || 'N/A',
                senderName: data.senderName || 'N/A',
                senderMobile: data.senderMobile || 'N/A', 
                amount: amount,
                payInAmount: data.payInAmount || 'N/A',
                serviceCharge: data.serviceCharge || 'N/A',
                totalAmount: data.totalAmount || 'N/A',
                exchangeRate: data.exchangeRate || 'N/A',
                ref: data.txnNo || '73644H66088',
                date: data.date || 'N/A',
                routingNumber: data.routingNumber || 'N/A',
                branchName: data.branchName || 'N/A',
                payoutCountry: data.payoutCountry || 'N/A',
                paymentChannel: data.paymentChannel || 'N/A',
                pin: data.pin || 'N/A'
            }).toString();
            
            window.open(receiptUrl, '_blank');
        }
    </script>
</body>
</html>
